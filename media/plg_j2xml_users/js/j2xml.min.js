/**
 * @package     Joomla.Plugins
 * @subpackage  J2xml.Users
 *
 * @version     __DEPLOY_VERSION__
 * @since       3.0.0
 *
 * @author      Helios Ciancio <info (at) eshiol (dot) it>
 * @link        https://www.eshiol.it
 * @copyright   Copyright (C) 2016 - 2022 Helios Ciancio. All Rights Reserved
 * @license     http://www.gnu.org/licenses/gpl-3.0.html GNU/GPL v3
 * J2XML is free software. This version may have been modified pursuant to the
 * GNU General Public License, and as distributed it includes or is derivative
 * of works licensed under the  GNU  General  Public  License or other free or
 * open source software licenses.
 */
!function(){var methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];console=window.console=window.console||{},methods.forEach((function(method){console[method]||(console[method]=function(){})}))}(),"undefined"==typeof eshiol&&(eshiol={}),void 0===eshiol.j2xml&&(eshiol.j2xml={}),void 0===eshiol.j2xml.convert&&(eshiol.j2xml.convert=[]),eshiol.j2xml.users={},eshiol.j2xml.users.version="__DEPLOY_VERSION__",eshiol.j2xml.users.requires="22.12.373",eshiol.j2xml.users.requiresj2XML="3.9.222",console.log("J2XML - Users Importer v"+eshiol.j2xml.users.version),eshiol.j2xml.convert.push((function(xml){if(console.log("eshiol.j2xml.convert.users"),versionCompare(eshiol.j2xml.version,eshiol.j2xml.users.requires)<0)return eshiol.renderMessages({error:["J2XML - Users Importer v"+eshiol.j2xml.users.version+" requires J2XML "+eshiol.j2xml.users.requiresj2XML]}),!1;console.log(xml);var csv=CSVToArray(xml,","),header=csv[0];console.log(header);for(var cols=[],i=0;i<header.length;i++)console.log(header[i]+": "+i),"group"==header[i]||"group."==header[i].substring(0,6)?(void 0===cols.group&&(cols.group=[]),cols.group.push(i)):"field."==header[i].substring(0,6)?(void 0===cols.fields&&(cols.fields=[]),cols.fields[header[i].substring(6)]=i):"profile."==header[i].substring(0,8)?(void 0===cols.profiles&&(cols.profiles=[]),cols.profiles[header[i].substring(8)]=i):cols[header[i]]=i;if(Object.keys(cols).forEach((function(key,index){Array.isArray(this[key])?Object.keys(this[key]).forEach((function(key1,index){console.log(key+"."+key1+": "+this[key1])}),this[key]):console.log(key+": "+this[key])}),cols),null==cols.username||null==cols.name||null==cols.email)return console.log("invalid CSV file"),xml;xml="";for(var i=1;i<csv.length;i++){console.log(csv[i]);var x="";x+="\t<user>\n",x+="\t\t<id>0</id>\n",x+="\t\t<name><![CDATA["+csv[i][cols.name]+"]]></name>\n",x+="\t\t<username><![CDATA["+csv[i][cols.username]+"]]></username>\n",x+="\t\t<email><![CDATA["+csv[i][cols.email]+"]]></email>\n",null!=cols.password&&null!=csv[i][cols.password]?x+="\t\t<password><![CDATA["+csv[i][cols.password]+"]]></password>\n":null!=cols.password_clear&&null!=csv[i][cols.password_clear]?x+="\t\t<password_clear><![CDATA["+csv[i][cols.password_clear]+"]]></password_clear>\n":(password_clear=Math.random().toString(36).slice(-8),x+="\t\t<password_clear><![CDATA["+password_clear+"]]></password_clear>\n"),x+="\t\t<requireReset>",null!=cols.requireReset?x+=eshiol.j2xml.users.requireReset:null==cols.requireReset?x+=eshiol.j2xml.users.requireReset:0==cols.requireReset?x+=0:1==cols.requireReset?x+=1:x+=eshiol.j2xml.users.requireReset,x+="</requireReset>\n",x+="\t\t<block>0</block>\n",x+="\t\t<sendEmail>0</sendEmail>\n",x+="\t\t<registerDate><![CDATA["+(new Date).toISOString().slice(0,19).replace("T"," ")+"]]></registerDate>\n",x+="\t\t<lastvisitDate><![CDATA[0000-00-00 00:00:00]]></lastvisitDate>\n",x+="\t\t<activation/>\n",x+='\t\t<params><![CDATA[{"admin_style":"","admin_language":"","language":"","editor":"","helpsite":"","timezone":""}]]></params>\n',x+="\t\t<lastResetTime><![CDATA[0000-00-00 00:00:00]]></lastResetTime>\n",x+="\t\t<resetCount>0</resetCount>\n",x+="\t\t<otpKey/>\n",x+="\t\t<otep/>\n";var groups=[];if(void 0!==cols.groups&&JSON.parse(csv[i][cols.groups]).forEach((function(group){Array.isArray(group)?groups.push(JSON.stringify(group)):groups.push(group)})),void 0!==cols.group)for(var j=0;j<cols.group.length;j++)groups.push(csv[i][cols.group[j]]);1==(groups=function(a){var seen={};return a.filter((function(item){return!seen.hasOwnProperty(item)&&(seen[item]=!0)}))}(groups)).length?x+="\t<group><![CDATA["+groups[0]+"]]></group>\n":groups.length>1&&(x+="\t\t<grouplist>\n",groups.forEach((function(group){x+="\t\t\t<group><![CDATA["+group+"]]></group>\n"})),x+="\t\t</grouplist>\n");var fields=[],n;void 0!==cols.fields&&Object.keys(cols.fields).forEach((function(key,index){fields[key]=csv[i][this[key]]}),cols.fields),1==(n=Object.keys(fields).length)?Object.keys(cols.fields).forEach((function(key,index){x+="\t\t<field>\n",x+='\t\t\t<name><![CDATA[["'+key+'"]]]></name>\n',x+='\t\t\t<value><![CDATA[["'+this[key]+'"]]]></value>\n',x+="\t\t</field>\n"}),fields):n>1&&(x+="\t\t<fieldlist>\n",Object.keys(cols.fields).forEach((function(key,index){x+="\t\t\t<field>\n",x+='\t\t\t\t<name><![CDATA[["'+key+'"]]]></name>\n',x+='\t\t\t\t<value><![CDATA[["'+this[key]+'"]]]></value>\n',x+="\t\t\t</field>\n"}),fields),x+="\t\t</fieldlist>\n");var profiles=[],n;void 0!==cols.profiles&&Object.keys(cols.profiles).forEach((function(key,index){profiles[key]=csv[i][this[key]]}),cols.profiles),1==(n=Object.keys(profiles).length)?Object.keys(cols.profiles).forEach((function(key,index){x+="\t\t<profile>\n",x+='\t\t\t<name><![CDATA[["'+key+'"]]]></name>\n',x+='\t\t\t<value><![CDATA[["'+this[key]+'"]]]></value>\n',x+="\t\t</profile>\n"}),profiles):n>1&&(x+="\t\t<profilelist>\n",Object.keys(cols.profiles).forEach((function(key,index){x+="\t\t\t<profile>\n",x+='\t\t\t\t<name><![CDATA[["'+key+'"]]]></name>\n',x+='\t\t\t\t<value><![CDATA[["'+this[key]+'"]]]></value>\n',x+="\t\t\t</profile>\n"}),profiles),x+="\t\t</profilelist>\n"),xml+=x+="\t</user>\n"}return'<?xml version="1.0" encoding="UTF-8"?>\n<j2xml version="19.2.0">\n'+xml+"</j2xml>"}));